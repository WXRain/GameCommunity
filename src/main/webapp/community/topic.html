<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>游戏帖子</title>
<script type="text/javascript" src="../script/jquery.min.js"></script>
<script type="text/javascript" src="../script/jquerySession.js"></script>
<script type="text/javascript" src="../script/getRootPath.js"></script>
<script type="text/javascript" src="../script/getParam.js"></script>
<script type="text/javascript" src="../script/utils.js"></script>
<script type="text/javascript">
	var path = getRootPath(); 
	var topicId = getParam("topicId");
	if(topicId == null || topicId.length == 0){
		$.session.set("errorMessage", "参数错误！");
		window.location.href = path + "/error.html";
	}
	var currentPage = getParam("page");
	if(currentPage == null || currentPage.length == 0){
		currentPage = 1;
	}
</script>
</head>
<body>
	<div><iframe align="center" width="100%" height="100" src="../top.html" frameborder="no" border="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></div>
	<span id="communityIndex"><a href=javascript:void(0) onclick="gameIndex()">xx论坛</a>&nbsp;&nbsp;&nbsp;></span>
	<span>&nbsp;&nbsp;&nbsp;<a href=javascript:void(0) onclick="gameTypeIndex()" id="gameTypeIndex"></a>&nbsp;&nbsp;&nbsp;></span>
	<span>&nbsp;&nbsp;&nbsp;<a href=javascript:void(0) onclick="sectionIndex()" id="sectionIndex"></a>&nbsp;&nbsp;&nbsp;></span>
	<span>&nbsp;&nbsp;&nbsp;<a href=javascript:void(0) onclick="topicIndex()" id="topicIndex"></a></span>
	<center><h2 id="topicTitle"></h2></center>
	<center><a id="jumpToGame" href=javascript:void(0)>查看游戏</a></center>
	<br/><br/><br/>
	<table width=100%>
		<tr>
			<td id="username" width=40% align="center">发帖用户：</td>
			<td id="createTime" width=40% align="center">发帖时间：</td>
			<td id="reply" width=20% align="center"><a href=javascript:void(0) onclick="reply()">回复</a></td>
		</tr>
	</table>
	<hr/>
	<br/><br/><br/>
	
	<div id="text"></div>
	<br/><br/><br/>
    <hr/>
    
<!--     <form action="" method="POST"> -->
<!--     <table width=100%> -->
<!--     <tr> -->
<!--     		<td align="right">回复主题：</td> -->
<!--     		<td><input id="replyName" name="replyName" type="text"/></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--     		<td align="right">回复内容：</td> -->
<!--     		<td><input id="replyText" name="replyText" type="text"/></td> -->
<!--     </tr> -->
<!--     <tr> -->
<!--     		<td align="right"><input type="submit"/></td> -->
<!--     		<td><input type="button" value="取消" onclick="cancelReply()"/></td> -->
<!--     </tr> -->
<!--     </table> -->
<!--     </form> -->

<table width=100%>
<tr>
	<td>回复用户</td>
	<td>回复主题</td>
	<td>回复内容</td>
	<td>回复时间</td>
</tr>
<tr><td colspan="4"><hr/></td></tr>
</table>

	
    
   <script type="text/javascript">
   		
   $(function(){
	   
		$.ajax({
			url: "initTopic.do",
			method: "POST",
			dataType: "JSON",
			data: {"topicId" : topicId},
			success: function(result){
				if(result.state == 0){
					createPage(result.data);
				}else{
					alert(result.message);
				}
			}
		});
		
		$.ajax({
			url: "showReply.do",
			method: "POST",
			dataType: "JSON",
			data: {
				"topicId" : topicId,
				"currentPage" : currentPage
			},
			success: function(result){
				if(result.state == 0){
					console.log(result);
				}else{
					alert(result.message);
				}
			}
		});
		
		
	});		
   
   function createPage(data){
	   if(data == null || data.length <= 0){
		   $.session.set("errorMessage", "帖子不存在！");
		   window.location.href = path + "/error.html";
	   }else{
		   console.log(data);
		   
		  $("#topicIndex").text(data.topicName); 
		  buildSectionIndex(data.sectionId);
		  
		  $("#topicTitle").text(data.topicName);
		  $("#username").append("<a href=javascript:void() onclick=showUser(" + data.userId + ")>" + data.username + "</a>");
		  $("#createTime").append(data.createTime);
		  $("#text").text(data.topicText);
	   }
	  
	   
	   
   }
   
   function buildSectionIndex(sectionId){
	   $.ajax({
			url: "showSection.do",
			method: "POST",
			dataType: "JSON",
			data: {"sectionId" : sectionId},
			success: function(result){
				if(result.state == 0){
					if(result.data == null || result.data.length == 0){
						$.session.set("errorMessage", "数据错误！");
						window.location.href = path + "/error.html";
					}
					buildGameTypeIndex(result.data.gameType);
					$("#jumpToGame").attr("onclick", "jumpToGame(" + result.data.gameId + ")");
					$("#sectionIndex").text(result.data.name);
					$("#sectionIndex").attr("onclick", "sectionIndex(" + result.data.id + ")");
				}else{
					alert(result.message);
				}
			}
		});
   }
   
   function buildGameTypeIndex(gameTypeId){
	   $.ajax({
			url: "showGameType.do",
			method: "POST",
			dataType: "JSON",
			data: {"gameTypeId" : gameTypeId},
			success: function(result){
				if(result.state == 0){
					if(result.data == null || result.data.length == 0){
						$.session.set("errorMessage", "游戏类型出错！");
						window.location.href = path + "/error.html";
					}
					console.log(result.data);
					$("#gameTypeIndex").text(result.data.typeName);
					$("#gameTypeIndex").attr("onclick", "gameTypeIndex(" + gameTypeId + ")");
				}else{
					alert(result.message);
				}
			}
		});
   }
   
   function gameIndex(){
	   window.location.href = path + "/community/main.html";
   }
   
   function gameTypeIndex(gameTypeId){
	   window.location.href = path + "/community/gameType.html?gameTypeId=" + gameTypeId;
   }
   
   function sectionIndex(sectionId){
	   window.location.href = path + "/community/section.html?sectionId=" + sectionId;
   }
   
   function topicIndex(){
	   window.location.href = path + "/community/topic.html?topicId=" + topicId;
   }
   
   function jumpToGame(gameId){
	   window.location.href = path + "/game/showGame.html?gameId=" + gameId;
   }
   
   function reply(){
	   var userId = $.session.get("userId");
	   if(userId == null || userId.length == 0){
		   $.session.set("errorMessage", "请先登录！");
		   window.location.href = path + "/error.html";
	   }
   }
   
   </script>
   
</body>
</html>